{% extends 'core/base.html' %}
{% load static from staticfiles %}

{% load breadcrumbs from directory_components %}
{% load thumbnail %}

{% block head_css %}
    {{ block.super }}
    <link href="{% static 'core/investment-support-directory-search.css' %}" media="all" rel="stylesheet" />
{% endblock %}

{% block content %}
<div class="container">
    {% url 'investment-support-directory:search' as search_url %}
    {% breadcrumbs left_url=services_urls.great_international left_label='Great.gov.uk international' middle_url=search_url middle_label='Find a UK specialist' right_label='Search results' %}
</div>
<form>
    <div id="hero-container">
        <div class="container">
            <div class="grid-row">  
                <div class="column-two-thirds">
                    {% if pagination.paginator.count %}
                        <h2 class="heading-medium">{{ pagination.paginator.count }} {{pagination.paginator.count|pluralize:'result,results'}} found {% if form.q.value %}for <mark>{{ form.q.value }}</mark>{% endif %}</h2>
                    {% else %}
                        <h2 class="heading-medium">No results found {% if form.q.value %}for <mark>{{ form.q.value }}</mark>{% endif %}</h2>
                    {% endif %}
                </div>
                <div class="column-one-third">
                    <span class="{{ field.css_classes }}" id="{{ field.id_for_label }}-container">
                      {% if form.q.errors %}
                        <div class="error-message">{{ form.q.errors }}</div>
                      {% else %}
                      <label for="{{ form.q.id_for_label }}">New search</label>
                      {% endif %}
                      {{ form.q }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div class="container" id="main-content">
        <div class="grid-row">   
            <div class="column-one-third" id="filter-column">
                <section class="margin-bottom-15">
                    <span>Filter results</span>
                    {% if filters %}
                        <div id="selected-filters-container" class="underline-flag-red">
                            <label>Selected filters</label>
                            {% for value in filters %}
                                <mark>{{ value }}</mark>
                            {% endfor %}
                            <a href="{% url 'investment-support-directory:search' %}?q={{ form.q.value }}" class="link">Clear all filters</a>
                        </div>
                    {% endif %}
                </section>
                <fieldset>
                    <legend>Filter by expertise</legend>
                    {% include 'investment_support_directory/filter.html' with label='Regional expertise' alt='Toggle list of regions' field=form.expertise_regions %}
                    {% include 'investment_support_directory/filter.html' with label='Industry expertise' alt='Toggle list of industries' field=form.expertise_industries %}
                    {% include 'investment_support_directory/filter.html' with label='Language expertise' alt='Toggle list of languages' field=form.expertise_languages %}
                    {% include 'investment_support_directory/filter.html' with label='International expertise' alt='Toggle list of countries' field=form.expertise_countries %}
                </fieldset>
                <fieldset>
                    <legend>Filter by specialist skills</legend>
                    {% include 'investment_support_directory/filter.html' with label='Financial' alt='Toggle list of Financial skills' field=form.expertise_products_services_financial %}
                    {% include 'investment_support_directory/filter.html' with label='Management consulting' alt='Toggle list of Management consulting skills' field=form.expertise_products_services_management %}
                    {% include 'investment_support_directory/filter.html' with label='Human resources and recruitment' alt='Toggle list of Human resources and recruitment skills' field=form.expertise_products_services_human_resources %}
                    {% include 'investment_support_directory/filter.html' with label='Legal' alt='Toggle list of Legal skills' field=form.expertise_products_services_legal %}
                    {% include 'investment_support_directory/filter.html' with label='Publicity and communications' alt='Toggle list of Publicity and communication skills' field=form.expertise_products_services_publicity %}
                    {% include 'investment_support_directory/filter.html' with label='Business support' alt='Toggle list of Business Support skills' field=form.expertise_products_services_business_support %}
                </fieldset>
                <button class="button" type="submit">Update results</button>
                <div class="margin-top-15 margin-bottom-30" id="reset-link-container">
                    <a href="{% url 'investment-support-directory:search' %}" class="link">Reset</a>
                </div>
            </div>
            <div class="column-two-thirds" id="companies-column">
                <ul>
                    {% for company in results %}
                        <li>
                            <a href="{% url 'investment-support-directory:profile' company_number=company.number slug=company.slug %}">
                                <div class="logo-container">
                                    {% thumbnail company.logo "x135" as logo %}
                                        <img src="{{ logo.url }}" alt="{{ company.name }}" />
                                    {% empty %}
                                        <img class="placeholder" src="{% static 'images/placeholder.png' %}" alt="" />
                                    {% endthumbnail %}
                                </div>
                                <div class="width-full details-container">
                                    <div class="result-header">
                                        <h3 class="heading-medium margin-0 link">{{ company.name }}</h3>
                                    </div>
                                    {% if company.description or company.summary %}
                                        {% if company.highlight %}
                                            {{ company.highlight|truncatechars_html:125 }}
                                        {% else %}
                                            {{ company.summary|default:company.description|truncatechars:135 }}
                                        {% endif %}
                                    {% endif %}
                                    <div class="grid-row result-footer width-full">
                                        {% if company.expertise_regions %}
                                            <div class="mid-grey-text font-xsmall column-one-half ellipsis">
                                                Regional expertise: <strong class="bold">{{ company.expertise_regions }}</strong>
                                            </div>
                                        {% endif %}
                                        {% if company.employees %}
                                            <div class="employees mid-grey-text font-xsmall column-one-half ellipsis">Number of employees: <strong class="bold">{{ company.employees }} Employees</strong></div>
                                        {% endif %}
                                    </div>
                                </div>
                            </a>
                        </li>
                    {% empty %}
                        <h2 class="heading-medium">No results</h2>
                    {% endfor %}
                </ul>
                {% if pagination.paginator.num_pages > 1 %}
                    <div id="paginator">
                        {% if pagination.has_previous %}
                            <a class="button-ghost-blue" href="{{ paginator_url }}&page={{ pagination.previous_page_number}}">Previous</a>
                        {% endif %}
                            <ol>
                                {% if pagination.paginator.num_pages <= 5 %}
                                    {% for number in pagination.paginator.page_range %}
                                        {% include 'investment_support_directory/paginator-item.html' %}
                                    {% endfor %}
                                {% elif pagination.number < 5 %}
                                    {% for number in pagination.paginator.page_range|slice:'0:4' %}
                                        {% include 'investment_support_directory/paginator-item.html' %}
                                    {% endfor %}
                                    <li class="active-blue-text margin-15"><span>...</span></li>
                                    {% include 'investment_support_directory/paginator-item.html' with number=pagination.paginator.num_pages %}
                                {% elif pages_after_current < 4 %}
                                    {% include 'investment_support_directory/paginator-item.html' with number='1' %}
                                    <li class="active-blue-text margin-15"><span>...</span></li>
                                    {% for number in pagination.paginator.page_range|slice:'-4:-1' %}
                                        {% include 'investment_support_directory/paginator-item.html' %}
                                    {% endfor %}
                                    {% include 'investment_support_directory/paginator-item.html' with number=pagination.paginator.num_pages %}
                                {% else %}
                                    {% include 'investment_support_directory/paginator-item.html' with number='1'%}
                                    <li class="active-blue-text margin-15"><span>...</span></li>
                                    {% include 'investment_support_directory/paginator-item.html' with number=pagination.number|add:'-1'%}
                                    {% include 'investment_support_directory/paginator-item.html' with number=pagination.number %}
                                    {% include 'investment_support_directory/paginator-item.html' with number=pagination.number|add:'1'%}
                                    <li class="active-blue-text margin-15"><span>...</span></li>
                                    {% include 'investment_support_directory/paginator-item.html' with number=pagination.paginator.num_pages %}
                                {% endif %}
                            </ol>
                        </span>
                        {% if pagination.has_next %}
                            <a class="button-ghost-blue" href="{{ paginator_url }}&page={{ pagination.next_page_number }}">Next</a>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</form>
{% endblock content %}

{% block body_js %}
<script type="text/javascript">

  function handleTogle(event) {
    var element = event.target;
    element.classList.toggle('checked');
    var formGroup = document.getElementById(element.getAttribute('aria-controls'));
    formGroup.setAttribute('aria-expanded', !(formGroup.getAttribute('aria-expanded') == 'true'));
  }
  var elements = document.getElementsByClassName('filter-collapse');
  for (var i = 0; i < elements.length; i++) { 
    elements[i].addEventListener('click', handleTogle);
  }
</script>
{% endblock %}
